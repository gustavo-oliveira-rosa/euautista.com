# Ativar rewrite engine
RewriteEngine On

# 1. BLOQUEAR ACESSO A ARQUIVOS SENSÍVEIS
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|inc|bak|sql)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# 2. IMPEDIR LISTAGEM DE DIRETÓRIOS
Options -Indexes

# 3. BLOQUEAR ACESSO DIRETO A CERTOS ARQUIVOS
<Files "*.txt">
    Deny from all
</Files>

<Files "*.md">
    Deny from all
</Files>

# 4. PROTEÇÃO CONTRA SCANNERS E BOTS MALICIOSOS
# Bloquear user agents suspeitos
RewriteCond %{HTTP_USER_AGENT} ^(wget|curl|libwww-perl|python|nikto|sqlmap) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^.*(scan|bot|crawler|spider).* [NC]
RewriteRule ^.* - [F,L]

# 5. BLOQUEAR ACESSO A PASTAS ESPECÍFICAS
<IfModule mod_rewrite.c>
    RewriteRule ^(\.git|node_modules|vendor)/ - [F,L]
</IfModule>

# 6. PROTEÇÃO CONTRA HOTLINKING (se tiver imagens)
# RewriteCond %{HTTP_REFERER} !^$
# RewriteCond %{HTTP_REFERER} !^https?://(www\.)?euseudominio\.com [NC]
# RewriteRule \.(jpg|jpeg|png|gif)$ - [F,L]

# 7. LIMITAR MÉTODOS HTTP PERMITIDOS
<LimitExcept GET POST>
    Deny from all
</LimitExcept>

# 8. HEADERS DE SEGURANÇA BÁSICOS
<IfModule mod_headers.c>
    # Proteção XSS
    Header set X-XSS-Protection "1; mode=block"
    # Prevenir clickjacking
    Header set X-Frame-Options "SAMEORIGIN"
    # Política de referrer
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# 9. COMPRESSÃO PARA MELHOR PERFORMANCE (opcional)
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript
</IfModule>

# Permitir o service worker e o manifest
<FilesMatch "^(sw\.js|manifest\.webmanifest)$">
  Require all granted
</FilesMatch>

AddType application/manifest+json .webmanifest
AddType application/javascript .js
